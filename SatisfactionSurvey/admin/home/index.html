<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Expires" content="0"/>
        <meta name="viewport"  content="width=device-width, initial-scale=1.0 ">
        <title>หน้าหลัก</title>
        <link rel="apple-touch-icon" href="../image/favicons/apple-touch-icon.png" sizes="180x180">
        <link rel="icon" href="../../image/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
        <link rel="icon" href="../../image/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
        <link rel="icon" href="../../image/favicons/favicon.ico">
        <script src="https://cdn.tailwindcss.com"></script>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="home.css">
       
        <script src="../../config.js"></script>

        <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
        <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>

        <link rel="stylesheet" href="jquery.datetimepicker.min.css">
        <script src="jquery.datetimepicker.full.min.js"></script>

    </head>
    <body>
        <div class="min-h-screen flex  items-center justify-center py-6 px-4 z-10 space-x-10 text-violet-950">
            <div>
                <div class="flex justify-center p-5 text-2xl ">
                    <h1>รายงานความพึงพอในการบริการ ของเจ้าหน้าที่</h1>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 pt-10 gap-10 lg:gap-5 w-full">
                    <div class="flex flex-col justify-between w-auto p-6 bg-white border border-gray-200 rounded-lg shadow relative h-56">
                        <div class="bg-white p-2 absolute border border-gray-200 rounded-lg -top-5 left-1/2 -translate-x-1/2">
                            รายวัน
                        </div>
                        <div class="flex justify-center pt-10">
                            <div 
                                class="shadow-lg flex gap-2 items-center bg-white p-2 
                                hover:shadow-xl duration-100 hover:border-2 border-gray-400 group delay-100 rounded-md"
                                >
                                <svg
                                    class="group-hover:rotate-[360deg] duration-300"
                                    ill="#000000" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                                    width="20px" height="20px" viewBox="0 0 610.398 610.398"
                                    xml:space="preserve"
                                >
                                <g>
                                <path d="M159.567,0h-15.329c-1.956,0-3.811,0.411-5.608,0.995c-8.979,2.912-15.616,12.498-15.616,23.997v10.552v27.009v14.052
                                    c0,2.611,0.435,5.078,1.066,7.44c2.702,10.146,10.653,17.552,20.158,17.552h15.329c11.724,0,21.224-11.188,21.224-24.992V62.553
                                    V35.544V24.992C180.791,11.188,171.291,0,159.567,0z"/>
                                <path d="M461.288,0h-15.329c-11.724,0-21.224,11.188-21.224,24.992v10.552v27.009v14.052c0,13.804,9.5,24.992,21.224,24.992
                                    h15.329c11.724,0,21.224-11.188,21.224-24.992V62.553V35.544V24.992C482.507,11.188,473.007,0,461.288,0z"/>
                                <path d="M539.586,62.553h-37.954v14.052c0,24.327-18.102,44.117-40.349,44.117h-15.329c-22.247,0-40.349-19.79-40.349-44.117
                                    V62.553H199.916v14.052c0,24.327-18.102,44.117-40.349,44.117h-15.329c-22.248,0-40.349-19.79-40.349-44.117V62.553H70.818
                                    c-21.066,0-38.15,16.017-38.15,35.764v476.318c0,19.784,17.083,35.764,38.15,35.764h468.763c21.085,0,38.149-15.984,38.149-35.764
                                    V98.322C577.735,78.575,560.671,62.553,539.586,62.553z M527.757,557.9l-446.502-0.172V173.717h446.502V557.9z"/>
                                <path d="M353.017,266.258h117.428c10.193,0,18.437-10.179,18.437-22.759s-8.248-22.759-18.437-22.759H353.017
                                    c-10.193,0-18.437,10.179-18.437,22.759C334.58,256.074,342.823,266.258,353.017,266.258z"/>
                                <path d="M353.017,348.467h117.428c10.193,0,18.437-10.179,18.437-22.759c0-12.579-8.248-22.758-18.437-22.758H353.017
                                    c-10.193,0-18.437,10.179-18.437,22.758C334.58,338.288,342.823,348.467,353.017,348.467z"/>
                                <path d="M353.017,430.676h117.428c10.193,0,18.437-10.18,18.437-22.759s-8.248-22.759-18.437-22.759H353.017
                                    c-10.193,0-18.437,10.18-18.437,22.759S342.823,430.676,353.017,430.676z"/>
                                <path d="M353.017,512.89h117.428c10.193,0,18.437-10.18,18.437-22.759c0-12.58-8.248-22.759-18.437-22.759H353.017
                                    c-10.193,0-18.437,10.179-18.437,22.759C334.58,502.71,342.823,512.89,353.017,512.89z"/>
                                <path d="M145.032,266.258H262.46c10.193,0,18.436-10.179,18.436-22.759s-8.248-22.759-18.436-22.759H145.032
                                    c-10.194,0-18.437,10.179-18.437,22.759C126.596,256.074,134.838,266.258,145.032,266.258z"/>
                                <path d="M145.032,348.467H262.46c10.193,0,18.436-10.179,18.436-22.759c0-12.579-8.248-22.758-18.436-22.758H145.032
                                    c-10.194,0-18.437,10.179-18.437,22.758C126.596,338.288,134.838,348.467,145.032,348.467z"/>
                                <path d="M145.032,430.676H262.46c10.193,0,18.436-10.18,18.436-22.759s-8.248-22.759-18.436-22.759H145.032
                                    c-10.194,0-18.437,10.18-18.437,22.759S134.838,430.676,145.032,430.676z"/>
                                <path d="M145.032,512.89H262.46c10.193,0,18.436-10.18,18.436-22.759c0-12.58-8.248-22.759-18.436-22.759H145.032
                                    c-10.194,0-18.437,10.179-18.437,22.759C126.596,502.71,134.838,512.89,145.032,512.89z"/>
                                </g>
                                </svg>
                                <input class="flex-1 focus:outline-none"  type="text" id="searchDateSurvey" placeholder="วันที่" autocomplete="off">
                                </div>
                                
                        </div>
                        
                        <div id="date_error" class="text-red-600 justify-center hidden">กรุณาใส่วันที่</div>

                        <div class="flex justify-center">
                            <button onclick="dateexport()" class="animated-button">
                                <svg viewBox="0 0 24 24" class="arr-2" xmlns="http://www.w3.org/2000/svg">
                                  <path
                                    d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"
                                  ></path>
                                </svg>
                                <span class="text">Export</span>
                                <span class="circle"></span>
                                <svg viewBox="0 0 24 24" class="arr-1" xmlns="http://www.w3.org/2000/svg">
                                  <path
                                    d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"
                                  ></path>
                                </svg>
                              </button>
                              
                        </div>
                        
                    </div>
                    <div class="flex flex-col justify-between w-auto p-6 bg-white border border-gray-200 rounded-lg shadow relative h-56">
                        <div class="bg-white p-2 absolute border border-gray-200 rounded-lg -top-5 left-1/2 -translate-x-1/2">
                            รายเดือน
                        </div>
                        <div class="flex justify-center pt-10 space-x-5">
                            <select name="" id="selectMonth" class="shadow-lg bg-white p-2  hover:shadow-xl duration-100 hover:border-2 
                            border-gray-400 group delay-100 rounded-md" required>
                                <option  value="" disabled selected hidden>เดือน</option>
                            </select>
                            <div class="w-1/2 shadow-lg bg-white p-2 hover:shadow-xl duration-100 hover:border-2 border-gray-400 group delay-100 rounded-md">
                                <input class="flex-1 focus:outline-none w-full" id="year"  type="number" min="1900" max="3000" step="1" value="">
                            </div>
                        </div>

                        <div id="month_error" class="text-red-600 justify-center hidden">กรุณาเลือกเดือนและปี</div>

                        <div class="flex justify-center">
                            <button onclick="monthexport()" class="animated-button">
                                <svg viewBox="0 0 24 24" class="arr-2" xmlns="http://www.w3.org/2000/svg">
                                  <path
                                    d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"
                                  ></path>
                                </svg>
                                <span class="text">Export</span>
                                <span class="circle"></span>
                                <svg viewBox="0 0 24 24" class="arr-1" xmlns="http://www.w3.org/2000/svg">
                                  <path
                                    d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"
                                  ></path>
                                </svg>
                              </button>
                              
                        </div>
                        
                    </div>
                </div>
                <div class="flex justify-center mt-14 space-x-10 hidden" id="adminonly">
                    <div>
                        
                            <button onclick="go_officer()"
                                class="text-lg  w-32 h-12 rounded bg-teal-500 text-white relative overflow-hidden group z-10 hover:text-white duration-1000"
                                >
                                <span
                                    class="absolute bg-teal-600 w-36 h-36 rounded-full group-hover:scale-100 scale-0 -z-10 -left-2 -top-10 group-hover:duration-500 duration-700 origin-center transform transition-all"
                                ></span>
                                <span
                                    class="absolute bg-teal-800 w-36 h-36 -left-2 -top-10 rounded-full group-hover:scale-100 scale-0 -z-10 group-hover:duration-700 duration-500 origin-center transform transition-all"
                                ></span>
                                จัดการเจ้าหน้าที่
                            </button>
                        
                    </div>
                    <div>
                        <button onclick="go_user()"
                            class="text-lg w-32 h-12 rounded bg-teal-500 text-white relative overflow-hidden group z-10 hover:text-white duration-1000"
                            >
                            <span
                                class="absolute bg-teal-600 w-36 h-36 rounded-full group-hover:scale-100 scale-0 -z-10 -left-2 -top-10 group-hover:duration-500 duration-700 origin-center transform transition-all"
                            ></span>
                            <span
                                class="absolute bg-teal-800 w-36 h-36 -left-2 -top-10 rounded-full group-hover:scale-100 scale-0 -z-10 group-hover:duration-700 duration-500 origin-center transform transition-all"
                            ></span>
                            จัดการผู้ใช้
                    </button>
                    </div>
                </div>
                <div class="flex justify-center mt-5">
                    <button onclick="handlelogout()" class="px-8 z-30 py-3 bg-rose-500 rounded-md 
                    text-white relative font-semibold after:-z-20 after:absolute after:h-1 after:w-1 
                    after:bg-rose-800 after:left-5 overflow-hidden after:bottom-0 after:translate-y-full 
                    after:rounded-md after:hover:scale-[300] after:hover:transition-all 
                    after:hover:duration-700 after:transition-all after:duration-700 transition-all 
                    duration-700 [text-shadow:3px_5px_2px_#be123c;] 
                    hover:[text-shadow:2px_2px_2px_#fda4af] text-2xl">ออกจากระบบ</button>
                </div>
            </div>
        </div>
    </body>
</html>

<script>
    function go_user(){
        window.location.href = config.apiURL+'/admin/user'
    }
    function go_officer(){
        window.location.href = config.apiURL+'/admin/officer'
    }
    if(!localStorage.token){
        window.location.href = config.apiURL+'/admin'
    }
    if(localStorage.role == "ADMIN"){
        document.getElementById('adminonly').classList.remove('hidden');

    }
    fetch(config.apiURL+'/api/login/checktoken.php', {
                method: 'POST',
                headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json; charset=UTF-8'
                },
                body: JSON.stringify({
                    token: localStorage.token
                })
            }).then(response => response.text())
            .then(result => {   
                var jsonObj = JSON.parse(result);
                if(jsonObj.RespCode == 400){
                    localStorage.clear();
                    window.location.href = config.apiURL+'/admin'
                }
                
            })
    const d = new Date();
    let year = d.getFullYear();
    let thaiyear = year+543;
    document.getElementById('year').value = thaiyear;

    function handlelogout(){
        fetch(config.apiURL+'/api/login/logout.php', {
                method: 'POST',
                headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json; charset=UTF-8'
                },
                body: JSON.stringify({
                    token: localStorage.token
                })
            }).then(response => response.text())
            .then(result => {   
                var jsonObj = JSON.parse(result);
                if(jsonObj.RespCode == 200){
                    console.log(jsonObj)
                    localStorage.clear();
                    window.location.href = config.apiURL+'/admin'
                }
            
            })
    }

    var select = document.getElementById("selectMonth");
    var options = ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม" ,"มิถุนายน" , "กรกฎาคม" ,"สิงหาคม" , "กันยายน" , "ตุลาคม" , "พฤศจิกายน" , "ธันวาคม"];
    for(var i = 0; i < options.length; i++) {
        var opt = options[i];
        var el = document.createElement("option");
        el.textContent = opt;
        el.value = i+1;
        select.appendChild(el);
    }
    $.datetimepicker.setLocale('th');
        $("#searchDateSurvey").datetimepicker({
        timepicker: false,
        format: 'd-m-Y', // กำหนดรูปแบบวันที่ ที่ใช้ เป็น 00-00-0000            
        lang: 'th', // ต้องกำหนดเสมอถ้าใช้ภาษาไทย และ เป็นปี พ.ศ.
        yearOffset: 543,
        maxDate: '0'
      })
    function dateexport(){
        const dateselcet = document.getElementById('searchDateSurvey');
        if(dateselcet.value.length <= 0){
            document.getElementById('date_error').classList.add('flex');
            document.getElementById('date_error').classList.remove('hidden');
            return false;
        }
        fetch(config.apiURL+'/api/excel/v2/dateexport.php?date='+dateselcet.value, {
                method: 'GET',
                headers: {
                'X-API-KEY': localStorage.token,
                'Accept': 'application/json',
                'Content-Type': 'application/json; charset=UTF-8'
                },
            }).then(result =>{
                document.getElementById('date_error').classList.add('hidden');
                document.getElementById('date_error').classList.remove('flex');
                window.open("../../api/excel/v2/Report.xlsx");
            });
    }
    function monthexport(){
        const monthselcet = document.getElementById('selectMonth').value;
        const year = document.getElementById('year').value;
        month_error
        if(monthselcet.length <=0 || year.length <= 0){
            document.getElementById('month_error').classList.add('flex');
            document.getElementById('month_error').classList.remove('hidden');
            return false;
        }
        fetch(config.apiURL+'/api/excel/v2/monthexport.php?month='+monthselcet+"&year="+year, {
                method: 'GET',
                headers: {
                'X-API-KEY': localStorage.token,
                'Accept': 'application/json',
                'Content-Type': 'application/json; charset=UTF-8'
                },
            }).then(result => {
                document.getElementById('month_error').classList.add('hidden');
                document.getElementById('month_error').classList.remove('flex');
                window.open("../../api/excel/v2/ReportMonth.xlsx");
            });
    }
</script>